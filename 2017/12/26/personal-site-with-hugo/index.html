<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>使用Hugo在GitHub Pages上搭建免费个人网站 - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>使用Hugo在GitHub Pages上搭建免费个人网站</h1>
  </div>
<div class="meta">
  <div>2017-12-26 00:00</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      </div>
  </div>
<div class="content">
  <p>This article talks about how to use <a href="https://gohugo.io/">Hugo</a> to build a personal website hosted on <a href="https://pages.github.com/">Github Pages</a>. It also introduces how to find a free custom domain name from <a href="http://www.freenom.com/">Freenom</a> and migrated the DNS server to <a href="https://www.cloudflare.com/">CloudFlare</a> in order to use HTTPs with chosen custom domain name on GitHub Pages.<br>
本文讲述了如何使用<a href="https://gohugo.io/">Hugo</a>将个人网页托管在<a href="https://pages.github.com/">Github Pages</a>上。同时也介绍了如何在<a href="http://www.freenom.com/">Freenom</a>上找到免费个人域名并利用<a href="https://www.cloudflare.com/">CloudFlare</a>的免费DNS服务在Github Pages上以HTTPs协议加载个人域名。</p>
<!-- toc -->
<h1 id="heading">前言</h1>
<p>最开始写博客始于2015年末，当时因为自制了几个单簧管演奏的视频，心想可以建一个简易的网站把录制背后的故事和想法集合起来。由于个人网站一般不需要太多交互，使用静态网页生成器并托管在<code>Github Pages</code>上成为了首选方案（能使用git实现版本控制更是个加分项）。彼时没想太多直接用了<code>Github Pages</code>原生支持的网页生成器<a href="https://jekyllrb.com/">Jekyll</a>。随便搜了一个主题，第一版网站便这么建了起来：</p>
<p><img src="https://open.saintic.com/api/bingPic?picSize=2" alt="">
<img src="https://open.saintic.com/api/bingPic?picSize=2" alt="">
<img src="https://open.saintic.com/api/bingPic?picSize=2" alt=""></p>
<p>在为期一年断断续续的更新中总计写下了十余篇音乐和程序相关的（毫无营养的）文章后，第一代模板差不多也看腻了，突然觉得是时候该把网站升级下。遂决定新的博客应更简洁规整，首页加入图片预览功能并减去不必要的视觉干扰，菜单栏里应有分类、标签和归档功能。一番搜寻后，目光落在<a href="https://gohugo.io/">Hugo</a>。主要原因在于<code>Hugo</code>简单易用——不需要安装太多<a href="https://hexo.io/">Hexo</a>中的依赖库，更换主题也比<code>Jekyll</code>方便，生成速度还很快。以下便是我的配置过程。</p>
<h1 id="hugo">安装Hugo</h1>
<blockquote>
<p>本文在macOS High Sierra环境下写成。Windows平台可参考官方文档做相应修改。</p>
</blockquote>
<p>如果Mac上已经装上了<a href="https://brew.sh/">Homebrew</a>，在命令行中直接敲下面的命令安装：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">brew install hugo
</code></pre></td></tr></table>
</div>
</div><p>如果Mac上没有安装<code>Homebrew</code>，可以考虑先装<code>Homebrew</code>再按上述步骤安装<code>Hugo</code>；也可以在<a href="https://github.com/gohugoio/hugo/releases">Hugo官网</a>直接下载使用可运行文件。</p>
<p>至此Hugo就安装完毕了。So easy.</p>
<h1 id="hugo-1">在Hugo中写文章</h1>
<p>在硬盘中选取合适的存储路径，然后命令行中使用如下指令生成网页本地文档：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hugo new site personal-site
</code></pre></td></tr></table>
</div>
</div><p>由此可得到如下文件目录：</p>
<pre><code>personal-site
├── archetypes
├── config.toml
├── content
├── data
├── layouts
├── static
└── themes
</code></pre><p>常用目录用处如下</p>
<table>
<thead>
<tr>
<th>子目录名称</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>archetypes</td>
<td>新文章默认模板</td>
</tr>
<tr>
<td>config.toml</td>
<td><code>Hugo</code>配置文档</td>
</tr>
<tr>
<td>content</td>
<td>存放所有<code>Markdown</code>格式的文章</td>
</tr>
<tr>
<td>layouts</td>
<td>存放自定义的<code>view</code>，可为空</td>
</tr>
<tr>
<td>static</td>
<td>存放图像、CNAME、css、js等资源，发布后该目录下所有资源将处于网页根目录</td>
</tr>
<tr>
<td>themes</td>
<td>存放下载的主题</td>
</tr>
</tbody>
</table>
<p>使用下面的命令生成新的文章草稿：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hugo new posts/first-post.md
</code></pre></td></tr></table>
</div>
</div><p>在content目录中会自动以<code>archetypes/default.md</code>为模板在<code>content/posts</code>目录下生成一篇名为<code>first-post.md</code>的文章草稿：</p>
<pre><code>---
title: &quot;First Post&quot;
date: 2017-12-27T23:15:53-05:00
draft: true
---

</code></pre><p>我们可以加一个标题在下面并去掉标记为草稿的这一行：<code>draft: true</code></p>
<pre><code>---
title: &quot;First Post&quot;
date: 2017-12-27T23:15:53-05:00
---

## Hello world

</code></pre><p>然后随便下载一个主题并加载到<code>config.toml</code>文件中：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git init
git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke

<span style="color:#75715e"># Edit your config.toml configuration file</span>
<span style="color:#75715e"># and add the Ananke theme.</span>
<span style="color:#111">echo</span> <span style="color:#d88200">&#39;theme = &#34;ananke&#34;&#39;</span> &gt;&gt; config.tomlecho <span style="color:#d88200">&#39;theme = &#34;ananke&#34;&#39;</span> &gt;&gt; config.toml
</code></pre></td></tr></table>
</div>
</div><p>现在使用如下命令建立本地服务器：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hugo server
</code></pre></td></tr></table>
</div>
</div><p>并在浏览器中输入网址<code>http://localhost:1313/</code>就可以在浏览器中查看网页效果了：</p>
<p><img src="/images/2017/2017-12-26/local_page.png" alt="local_page"></p>
<p>如果觉得没有问题了便可以使用如下命令：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hugo
</code></pre></td></tr></table>
</div>
</div><p>如此一来网页便生成在默认的public子目录中了。</p>
<h1 id="github">发布并托管到Github</h1>
<p>上传到Github之前，先在Github中添加一个空白repository，注意不要添加如<code>README</code>，<code>.gitignore</code>等文档。由此得到Github中该repository的网址：<code>https://github.com/Nianze/personal-site.git</code></p>
<p><img src="/images/2017/2017-12-26/repo.png" alt="new repo"></p>
<p>复制该网址后，在网站本地文档根目录中初始化git：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git init
git add .
git commit -m <span style="color:#d88200">&#34;first commit&#34;</span>
git remote add origin https://github.com/Nianze/personal-site.git
git push -u origin master
</code></pre></td></tr></table>
</div>
</div><p>至此所有源文档就都push到Github上了。然而此时Github对待这些源文档跟其他任何普通的repository中的代码并没有任何不同，并不会将public子目录中的网页托管在<code>Github Pages</code>上。</p>
<p>参见<a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/">Hugo官方文档</a>，可以选择以下两种方式让<code>Github Pages</code>加载我们想要托管的<code>/public</code>子目录中的网页：</p>
<ol>
<li>配置<code>Hugo</code>将网页生成在名为<code>/docs</code>的子目录中，然后直接push到<code>master branch</code></li>
<li>仍然使用默认的<code>/public</code>子目录存储网页，再单独建立一个<code>gh-pages branch</code></li>
</ol>
<h2 id="docsmaster-branch">使用<code>/docs</code>发布到master branch</h2>
<p>第一种方案的好处在于一次push即可将源文档和对应生成的网页文档都发布到Github，操作非常简单。所需要的仅是在config.toml中添加如下一行配置，使得生成的网页默认保存在<code>/docs</code>子目录下：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#111">publishDir</span> <span style="color:#f92672">=</span> docs
</code></pre></td></tr></table>
</div>
</div><p>自此运行<code>hugo</code>命令后生成的网页文件将保存在<code>/docs</code>子目录下。将所有文档push到Github的<code>master branch</code>，进入Github对应repository的Settings标签菜单，在<code>GitHub Pages</code>选项的Source栏选择<code>master branch /docs folder</code>:</p>
<p><img src="/images/2017/2017-12-26/docs_folder.png" alt="docs"></p>
<p>等待片刻即可访问<code>http://your_name.github.io</code>看到之前用<code>Hugo</code>生成的网页了。</p>
<h2 id="gh-pages-branch">发布到gh-pages branch</h2>
<p>如果希望单独控制源文档和生成的网页文档的版本历史，可以使用单独建立一个<code>gh-pages branch</code>的方法托管到<code>Github Pages</code>——先将<code>/public</code>子目录添加到<code>.gitignore</code>中，让<code>master branch</code>忽略其更新，然后在本地和Github端添加一个名为<code>gh-pages</code>的branch：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">//忽略public子目录
<span style="color:#111">echo</span> <span style="color:#d88200">&#34;public&#34;</span> &gt;&gt; .gitignore
//初始化gh-pages branch
git checkout --orphan gh-pages
git reset --hard
git commit --allow-empty -m <span style="color:#d88200">&#34;Initializing gh-pages branch&#34;</span>
git push origin gh-pages
git checkout master
</code></pre></td></tr></table>
</div>
</div><p>为了提高每次发布的效率，可以将下述命令存在脚本中，每次只需要运行该脚本即可将<code>gh-pages branch</code>中的文章发布到Github的repo中：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">if</span> <span style="color:#f92672">[</span><span style="color:#f92672">[</span> <span style="color:#00a8c8">$(</span>git status -s<span style="color:#00a8c8">)</span> <span style="color:#f92672">]</span><span style="color:#f92672">]</span>
<span style="color:#00a8c8">then</span>
    <span style="color:#111">echo</span> <span style="color:#d88200">&#34;The working directory is dirty. Please commit any pending changes.&#34;</span>
    <span style="color:#111">exit</span> 1<span style="color:#111">;</span>
<span style="color:#00a8c8">fi</span>

<span style="color:#111">echo</span> <span style="color:#d88200">&#34;Deleting old publication&#34;</span>
rm -rf public
mkdir public
rm -rf .git/worktrees/public/

<span style="color:#111">echo</span> <span style="color:#d88200">&#34;Checking out gh-pages branch into public&#34;</span>
git worktree add -B gh-pages public origin/gh-pages

<span style="color:#111">echo</span> <span style="color:#d88200">&#34;Removing existing files&#34;</span>
rm -rf public/*

<span style="color:#111">echo</span> <span style="color:#d88200">&#34;Generating site&#34;</span>
hugo

<span style="color:#111">echo</span> <span style="color:#d88200">&#34;Updating gh-pages branch&#34;</span>
<span style="color:#111">cd</span> public <span style="color:#f92672">&amp;&amp;</span> git add --all <span style="color:#f92672">&amp;&amp;</span> git commit -m <span style="color:#d88200">&#34;Publishing to gh-pages (publish.sh)&#34;</span>

<span style="color:#111">echo</span> <span style="color:#d88200">&#34;Push to origin&#34;</span>
git push origin gh-pages

</code></pre></td></tr></table>
</div>
</div><p>最后将<code>master branch</code>中的源文档和<code>gh-pages branch</code>中的网页文档分别push到Github repo中，进入Settings标签菜单，选择<code>Github Pages</code>项中的Source栏，点<code>gh-pages branch</code>选项：</p>
<p><img src="/images/2017/2017-12-26/gh-pages.png" alt="gh-pages"></p>
<p>同样等待片刻，即可访问<code>https://your_name.github.io</code>看到之前用<code>Hugo</code>生成的网页了。</p>
<h1 id="heading-1">配置个人域名</h1>
<p>如果觉得使用<code>your_name.github.io</code>不够酷炫，还可以考虑使用自选的个人域名。好的个人域名自然是需要到对应服务商购买的。常见的域名如<code>.com</code>, <code>.net</code>, <code>.me</code>一般都不免费，但好在非顶级域名的年费其实也不贵。由于我建网的初衷只是自娱自乐，暂时并没有付费购买域名的意向，索性直接去<a href="http://www.freenom.com/">Freenom</a>找了免费域名来用。目前Freenom平台提供的免费域名后缀为<code>.tk</code>, <code>.ml</code>,<code>ga</code>,<code>cf</code>,<code>gq</code>等。购买域名很简单，先在<a href="http://www.freenom.com/">Freenom</a>
网站上注册账号，然后查看自己想要的域名的价格并根据提示下单即可。考虑到现在machine leanring这么火，我就选了<code>nianze.ml</code>这个免费域名。</p>
<p>域名买好后还需要设置下域名解析。由于默认使用的是Freenom的DNS服务器，所以需要在<code>Manage Domain</code>菜单中配置域名解析规则。在<code>Manage Freeenom DNS</code>选项中添加如下两条规则：</p>
<ol>
<li>添加A记录（即地址记录，用来指定域名的IP地址），主机记录（Name）栏填www，记录值(Target)那栏填Github服务器IP地址（或者<code>your_name.github.io</code>的IP地址）</li>
<li>添加CNAME记录（用于将一个域名映射到另一个域名），主机记录栏填@，记录值那栏填<code>your_name.github.io</code></li>
</ol>
<p>其中，Github服务器IP地址是<code>192.30.252.153</code>和<code>192.30.252.154</code>，而<code>your_name.github.io</code>的IP地址可以在命令行中使用ping命令得到：</p>
<p><img src="/images/2017/2017-12-26/ping.png" alt="ping"></p>
<p>最后还需要在<code>personal-site/public</code>子目录中需要添加一个名为CNAME的文档，该文件只包含想要替换的个人域名，对我来说即是nianze.ml（不加http）。由于每次使用<code>hugo</code>命令
在<code>/public</code>子目录生成网页的时候该CNAME文件都会被删除，所以最好将该文件放在<code>personal-site/static</code>子目录中，这样运行<code>hugo</code>后该CNAME文件将自动复制到<code>/public</code>目录中。</p>
<p>等待几小时，在浏览器中访问<code>nianze.ml</code>就可以看到熟悉的个人网站页面了。</p>
<h1 id="cloudflarehttps">配置CloudFlare以使用HTTPs</h1>
<p>之所以想要使用<a href="https://www.cloudflare.com/">CloudFlare</a>，是因为上一步当我们配置好个人域名后，由于<code>Github Pages</code>不支持在自定义域名中使用<code>HTTPs</code>协议，所以浏览器中访问<code>nianze.ml</code>使用的是<code>HTTP</code>协议。这造成一个弊端：每回用Chrome打开<code>nianze.ml</code>，浏览器都提示该网页不受信任，如果网页中还有待加载的<code>JavaScript</code>代码,就得单独点浏览器地址栏右侧的<code>load</code>按钮才能正常加载全部页面，非常麻烦。再加上考虑到<code>HTTPs</code>协议比<code>HTTP</code>更快更安全，显然应该想办法解决这个问题。</p>
<p>好在<a href="http://www.freenom.com/">CloudFlare</a>为我们提供了一套方便的解决方案，而且是免费的！</p>
<p>首先点开<code>CloudFlare</code>注册账号，输入前面选好的个人域名<code>nianze.ml</code>，<code>CloudFlare</code>会给我们提供众多服务套餐，选择免费的那个套餐即可:)</p>
<p>此时<code>CloudFlare</code>会给我们提供其DNS服务器的IP，此时需要去<code>Freenom</code>的域名管理页面中更新默认DNS服务商到CloudFlare：</p>
<p><img src="/images/2017/2017-12-26/dns_server.png" alt="dns_server"></p>
<p>更改完DNS服务器就可以设置<code>CloudFlare</code>中的各个选项了。首先在<code>Crypto</code>选项标签下，选择使用<code>Full SSL</code>模式以<code>HTTPs</code>协议加载网页：</p>
<p><img src="/images/2017/2017-12-26/cf_ssl.png" alt="cf_ssl"></p>
<p>然后是<code>DNS</code>标签栏配置，跟<code>Freenom</code>设置类似：</p>
<p><img src="/images/2017/2017-12-26/cf_dns.png" alt="cf_dns"></p>
<p>最后再设置下<code>Page Rules</code>标签：</p>
<p><img src="/images/2017/2017-12-26/cf_page_rules.png" alt="page_rules"></p>
<p>至此配置完毕。其实<code>CloudFlare</code>中还有很多别的选项，可以根据个人喜好进行相应配置。等待几小时，再次访问<code>nianze.ml</code>，可以发现网页已经在<code>HTTPs</code>协议下加载了。这样以来就再也不用去点那个烦人的load按钮了。</p>
<h1 id="heading-2">后记</h1>
<p>至此我的新版博客就迁移完毕了，基本满足我现在写文章、摄影和音乐的各项需求。下一步准备在摄影栏目中加上一个照片墙功能。</p>
<h1 id="heading-3">参考文档</h1>
<ol>
<li><a href="https://themes.gohugo.io/hugo-tranquilpeak-theme/">Hugo Tranquilpeak Theme</a></li>
<li><a href="https://www.jonathan-petitcolas.com/2017/01/13/using-https-with-custom-domain-name-on-github-pages.html">Using HTTPs with Custom Domain Name</a></li>
<li><a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/">Deploy Hugo to Github</a></li>
</ol></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
