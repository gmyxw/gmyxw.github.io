<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>[EMCpp]Item-5 Prefer Auto to Explicit Type Declarations - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>[EMCpp]Item-5 Prefer Auto to Explicit Type Declarations</h1>
  </div>
<div class="meta">
  <div>2018-07-07 13:33</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      <span><a href="https://sy123.ml/tags/cpp/">#cpp</a></span>
      </div>
  </div>
<div class="content">
  <p>Despite some pitfalls described in EMCpp item 2 and 6, <code>auto</code> variables are preferred for they must be initialized, are generally immune to type mismatches that can lead to portability or efficiency problems, can ease the process of refactoring, and typically require less typing than variables with explicitly specified types.</p>
<!-- toc -->
<h1 id="avoidance-of-uninitialized-variables">Avoidance of Uninitialized variables</h1>
<p><code>auto</code> variavbles have their type deduced from their initializer, so they must be initialized.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">int</span> <span style="color:#111">x1</span><span style="color:#111">;</span>  <span style="color:#75715e">// potentially unintialized
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">x2</span><span style="color:#111">;</span>  <span style="color:#75715e">// error! initializer required
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">x3</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75715e">// fine, x3&#39;s value is well-defined
</span></code></pre></td></tr></table>
</div>
</div><h1 id="avoidance-of-syntactic-verbosity">Avoidance of Syntactic Verbosity</h1>
<p>In order to express the type of the value pointed to by an iterator, without <code>auto</code>, we may write like this:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">template</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">typename</span> <span style="color:#111">It</span><span style="color:#f92672">&gt;</span>
<span style="color:#00a8c8">void</span> <span style="color:#111">dwim</span><span style="color:#111">(</span><span style="color:#111">It</span> <span style="color:#111">b</span><span style="color:#111">,</span> <span style="color:#111">It</span> <span style="color:#111">e</span><span style="color:#111">)</span> <span style="color:#75715e">// &#34;do what I mean&#34;. for all elements in range from b to e
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
    <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#111">;</span> <span style="color:#111">b</span> <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">;</span> <span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#111">b</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">typename</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">iterator_traits</span><span style="color:#f92672">&lt;</span><span style="color:#111">It</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">value_type</span> <span style="color:#111">currValue</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span><span style="color:#111">b</span><span style="color:#111">;</span>
        <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Thanks to <code>auto</code>, now we can declare a local variable whose value is that of a dereferenced iterator with ease:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">template</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">typename</span> <span style="color:#111">It</span><span style="color:#f92672">&gt;</span>
<span style="color:#00a8c8">void</span> <span style="color:#111">dwim</span><span style="color:#111">(</span><span style="color:#111">It</span> <span style="color:#111">b</span><span style="color:#111">,</span> <span style="color:#111">It</span> <span style="color:#111">e</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#111">;</span> <span style="color:#111">b</span> <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#111">e</span><span style="color:#111">;</span> <span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#111">b</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">auto</span> <span style="color:#111">currValue</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span><span style="color:#111">b</span><span style="color:#111">;</span>
        <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="ability-to-hold-closure">Ability to Hold Closure</h1>
<p>Because <code>auto</code> uses type deduction, it can represent types known only to compilers, such as lambda expressions:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// C++14
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">derefLess</span> <span style="color:#f92672">=</span>           <span style="color:#75715e">// comparison func. for values pointed
</span><span style="color:#75715e"></span>    <span style="color:#111">[</span><span style="color:#111">]</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#00a8c8">auto</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p1</span><span style="color:#111">,</span>     <span style="color:#75715e">// to by anything pointer-like
</span><span style="color:#75715e"></span>       <span style="color:#00a8c8">const</span> <span style="color:#00a8c8">auto</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p2</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#f92672">*</span><span style="color:#111">p1</span> <span style="color:#f92672">&lt;</span> <span style="color:#f92672">*</span><span style="color:#111">p2</span><span style="color:#111">;</span> <span style="color:#111">}</span><span style="color:#111">;</span>  
</code></pre></td></tr></table>
</div>
</div><p>or in C++11, a little more verbose:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// C++11 doesn&#39;t support auto for parameters to lambda, so more verbose.
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">derefUPLess</span> <span style="color:#f92672">=</span>  <span style="color:#75715e">// comparison func. for Wdigets pointed
</span><span style="color:#75715e"></span>    <span style="color:#111">[</span><span style="color:#111">]</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p1</span><span style="color:#111">,</span>  <span style="color:#75715e">// to by std::unique_ptr
</span><span style="color:#75715e"></span>       <span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p2</span><span style="color:#111">)</span>  
    <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#f92672">*</span><span style="color:#111">p1</span> <span style="color:#f92672">&lt;</span> <span style="color:#f92672">*</span><span style="color:#111">p2</span><span style="color:#111">;</span> <span style="color:#111">}</span><span style="color:#111">;</span> 
</code></pre></td></tr></table>
</div>
</div><p>Without using <code>auto</code>, since lambda expressions yield closures, which are callable objects, we can store them in <code>std::function</code> objects:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">function</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">bool</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span><span style="color:#111">,</span> 
              <span style="color:#00a8c8">bool</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span><span style="color:#111">)</span><span style="color:#f92672">&gt;</span>
    <span style="color:#111">derefUPLess</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#111">]</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p1</span><span style="color:#111">,</span> <span style="color:#75715e">// comparison func. for Wdigets pointed
</span><span style="color:#75715e"></span>                     <span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p2</span><span style="color:#111">)</span> <span style="color:#75715e">// to by std::unique_ptr
</span><span style="color:#75715e"></span>                    <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#f92672">*</span><span style="color:#111">p1</span> <span style="color:#f92672">&lt;</span> <span style="color:#f92672">*</span><span style="color:#111">p2</span><span style="color:#111">;</span> <span style="color:#111">}</span><span style="color:#111">;</span>
</code></pre></td></tr></table>
</div>
</div><p>As we can see, syntactic verbosity makes <code>auto</code> a preferred choice. Besides that, there are two more reasons to choose <code>auto</code>:</p>
<ol>
<li><code>std::function</code> object typically uses more memory than the <code>auto</code>-declared object<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</li>
<li>invoking a closure via a <code>std::function</code> object is almost certain to be slower than calling it via an <code>auto</code>-declared object<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</li>
</ol>
<p>In summary, <code>auto</code> wins the competition between <code>auto</code> and <code>std::function</code> for holding a closure.</p>
<h1 id="avoidance-of-unexpected-implicit-conversions">Avoidance of Unexpected Implicit Conversions</h1>
<p>Consider this code:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unordered_map</span><span style="color:#f92672">&lt;</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">string</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span><span style="color:#f92672">&gt;</span> <span style="color:#111">m</span><span style="color:#111">;</span>
<span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">pair</span><span style="color:#f92672">&lt;</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">string</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p</span> <span style="color:#111">:</span> <span style="color:#111">m</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>This looks perfectly reasonable, but there's a problem: the key part of a <code>std::unorderd_map</code> is <code>const</code>, so the type of <code>std::pair</code> in the hash table isn't <code>std::pair&lt;std::string, int&gt;</code>, but <code>std::pair&lt;const std::string, int&gt;</code>. Since the constness hasn't been declared for the variable <code>p</code> in the loop, compilers will create a temporary object of the type that <code>p</code> wants to bind to by coping each object in <code>m</code>, then binding the reference <code>p</code> to that temporary object, and finally destroy the temporary at the end of each loop iteration. This is almost certain to be an unwanted behavior - we probably intend to simply bind the reference <code>p</code> to each element in <code>m</code> directly.</p>
<p>Such unintentional type mismatches can be <code>auto</code>ed away:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">auto</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p</span> <span style="color:#111">:</span> <span style="color:#111">m</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="avoidance-of-explicit-type-revising-during-refactoring">Avoidance of Explicit Type Revising during Refactoring</h1>
<p><code>auto</code> types automatically change if the type of their initializing expression changes, and that means that some refactoring (e.g., change the return type of a function from <code>int</code> to <code>long</code>) are facilitated by the use of <code>auto</code>:</p>
<ul>
<li>if the results of calling the function are stored in <code>auto</code> variables, the calling code automatically updates itself the next time we compile</li>
<li>if the results are stored in varibles explicitly declared to be <code>int</code>, we have to find all the call sites so that we can revise them.</li>
</ul>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>An <code>auto</code>-declared variable holding a closure has the same type as the closure, and uses only as much memory as the closure requires. The type of a <code>std::function</code>-declared variable holding a closure is an instantiation of the <code>std::function</code> template, and that has a fixed size for any given signature. When this size is not adequate for the closure, <code>std::function</code> constructor will allocate heap memory to store the closure - leading to typical result that <code>std::function</code> object uses more memory than the <code>auto</code>-declared object. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>This slowness comes from the implementation details of <code>std::function</code>, which restrict inlining and yield indirect function calls. <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
