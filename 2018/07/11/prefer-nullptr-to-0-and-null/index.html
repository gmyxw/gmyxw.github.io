<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>[EMCpp]Item-8 Prefer Nullptr to 0 and NULL - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>[EMCpp]Item-8 Prefer Nullptr to 0 and NULL</h1>
  </div>
<div class="meta">
  <div>2018-07-11 18:03</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      <span><a href="https://sy123.ml/tags/cpp/">#cpp</a></span>
      </div>
  </div>
<div class="content">
  <p><code>nullptr</code> doean't suffer from the overloading problem or the template deduction problem that 0 and <code>NULL</code> are susceptible to. It also improves code clarity.</p>
<p>In C++98, a null pointer can be represented by an <code>int</code> 0 or <code>NULL</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, which introduses some controdiction between the <em>apparent</em> meaning (mean to refer to a null pointer) and <em>actual</em> meaning (the representation is some kind of integer). Neither <code>0</code> nor <code>NULL</code> has a pointer type - it's just that C++ will (reluctently) interpret them as a null pointer in the context where a pointer a pointer is wanted but can't be found.</p>
<p>That's why <code>nullptr</code> is introduced: its type is not integral, but <code>std::nullptr_t</code><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>, which could be treated as a pointer of all types due to its ability to implicitly convert to all raw pointer types.</p>
<p>Compared with 0 and <code>NULL</code>, the obvious advantages shown by <code>nullptr</code> is its better support for overloading and template, as well as its improved code clarity.</p>
<h4 id="overloading">Overloading</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">f</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">f</span><span style="color:#111">(</span><span style="color:#00a8c8">bool</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">f</span><span style="color:#111">(</span><span style="color:#00a8c8">void</span><span style="color:#f92672">*</span><span style="color:#111">)</span><span style="color:#111">;</span>

<span style="color:#111">f</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// calls f(int)
</span><span style="color:#75715e"></span><span style="color:#111">f</span><span style="color:#111">(</span><span style="color:#111">NULL</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// might not compile, but typically calls f(int), never calls f(void*)
</span><span style="color:#75715e"></span><span style="color:#111">f</span><span style="color:#111">(</span><span style="color:#00a8c8">nullptr</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// calls f(void*)
</span></code></pre></td></tr></table>
</div>
</div><h4 id="template">Template</h4>
<p>Inside a template, if an <code>int</code> or <code>NULL</code> (which is <code>int</code>-like type) is being passed to a function that requires a pointer, type errors occur:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// call these only then approriate mutix is locked
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#75af00">f1</span><span style="color:#111">(</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">shared_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span> <span style="color:#111">spw</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">f2</span><span style="color:#111">(</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">unique_ptr</span><span style="color:#f92672">&lt;</span><span style="color:#111">Widget</span><span style="color:#f92672">&gt;</span> <span style="color:#111">upw</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#00a8c8">bool</span> <span style="color:#75af00">f3</span><span style="color:#111">(</span><span style="color:#111">Widget</span><span style="color:#f92672">*</span> <span style="color:#111">pw</span><span style="color:#111">)</span><span style="color:#111">;</span>

<span style="color:#00a8c8">template</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">typename</span> <span style="color:#111">FuncType</span><span style="color:#111">,</span>
         <span style="color:#00a8c8">typename</span> <span style="color:#111">MuxType</span><span style="color:#111">,</span>
         <span style="color:#00a8c8">typename</span> <span style="color:#111">PtrType</span><span style="color:#f92672">&gt;</span>
<span style="color:#111">declType</span><span style="color:#111">(</span><span style="color:#00a8c8">auto</span><span style="color:#111">)</span> <span style="color:#111">lockAndCall</span><span style="color:#111">(</span><span style="color:#111">FuncType</span> <span style="color:#111">func</span><span style="color:#111">,</span>  <span style="color:#75715e">// C++14
</span><span style="color:#75715e"></span>                           <span style="color:#111">MuxType</span><span style="color:#f92672">&amp;</span> <span style="color:#111">mutex</span>
                           <span style="color:#111">PtrType</span> <span style="color:#111">ptr</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">using</span> <span style="color:#111">MuxGuard</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">lock_guard</span><span style="color:#f92672">&lt;</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">mutex</span><span style="color:#f92672">&gt;</span><span style="color:#111">;</span>
    <span style="color:#111">MuxGuard</span> <span style="color:#75af00">g</span><span style="color:#111">(</span><span style="color:#111">mutex</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// lock mutex for func
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">return</span> <span style="color:#75af00">func</span><span style="color:#111">(</span><span style="color:#111">ptr</span><span style="color:#111">)</span><span style="color:#111">;</span>   <span style="color:#75715e">// pass ptr (pointer type) to func
</span><span style="color:#75715e"></span><span style="color:#111">}</span>                       <span style="color:#75715e">// unlock mutex
</span><span style="color:#75715e"></span>
<span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">mutex</span> <span style="color:#111">f1m</span><span style="color:#111">,</span> <span style="color:#111">f2m</span><span style="color:#111">,</span> <span style="color:#111">f3m</span><span style="color:#111">;</span>
<span style="color:#00a8c8">auto</span> <span style="color:#111">result1</span> <span style="color:#f92672">=</span> <span style="color:#111">lockAndCall</span><span style="color:#111">(</span><span style="color:#111">f1</span><span style="color:#111">,</span> <span style="color:#111">f1m</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#111">;</span>        <span style="color:#75715e">// error
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">result2</span> <span style="color:#f92672">=</span> <span style="color:#111">lockAndCall</span><span style="color:#111">(</span><span style="color:#111">f2</span><span style="color:#111">,</span> <span style="color:#111">f2m</span><span style="color:#111">,</span> <span style="color:#111">NULL</span><span style="color:#111">)</span><span style="color:#111">;</span>     <span style="color:#75715e">// error
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">result3</span> <span style="color:#f92672">=</span> <span style="color:#111">lockAndCall</span><span style="color:#111">(</span><span style="color:#111">f3</span><span style="color:#111">,</span> <span style="color:#111">f3m</span><span style="color:#111">,</span> <span style="color:#00a8c8">nullptr</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// fine
</span></code></pre></td></tr></table>
</div>
</div><p>In contrast, here, when <code>nullptr</code> is passed to <code>lockAndCall</code>, the type for <code>ptr</code> is deduced to be <code>std::nullptr_t</code> instead of previous <code>int</code> (or <code>int</code>-like one), and when <code>ptr</code> is passed to <code>f3</code>, there is an implicit conversion from <code>std::nullptr_t</code> to <code>Widget*</code>.</p>
<h4 id="code-clarity">Code clarity</h4>
<p>Using 0, the return type may not be obvious, is it an integral type or a pointer type?</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">auto</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">findRecord</span><span style="color:#111">(</span><span style="color:#75715e">/* args. */</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">result</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>There's no ambiguity when using <code>nullptr</code>:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">auto</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#111">findRecord</span><span style="color:#111">(</span> <span style="color:#75715e">/* args */</span> <span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">result</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#00a8c8">nullptr</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>There is some leeway regarding the implementaition of the type of <code>NULL</code> - possibly, <code>NULL</code> will be defined to be <code>0L</code> as a <code>long</code>. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><code>std::nullptr_t</code>, techniquely, is not a pointer type. The type is in a circular definition: <code>std::nullptr_t</code> is defined to be the type of <code>nullptr</code>. <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
