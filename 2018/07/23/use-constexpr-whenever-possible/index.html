<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>[EMCpp]Item-15 Use Constexpr Whenever Possible - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>[EMCpp]Item-15 Use Constexpr Whenever Possible</h1>
  </div>
<div class="meta">
  <div>2018-07-23 19:27</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      <span><a href="https://sy123.ml/tags/cpp/">#cpp</a></span>
      </div>
  </div>
<div class="content">
  <p><code>constexpr</code> objects are <code>const</code> and are initialized with values known during compilation; <code>constexpr</code> functions can produce copmile-time results when called with arguments whose values are know during compilations.</p>
<!-- toc -->
<h1 id="constexpr-objects"><code>constexpr</code> objects</h1>
<p>Values known during compmilation are privileged: they may be placed in read-only memory (important for embedded systems), and part of them with constant integral values can be used in contexts where C++ requires an <em>integral constant expression</em><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. Thuse, if we want the compilers to ensure that a variable is constant with a value know at compile time, we declare it <code>constexpr</code>:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">int</span> <span style="color:#111">sz</span><span style="color:#111">;</span>  <span style="color:#75715e">// non-constexpr variable
</span><span style="color:#75715e"></span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">auto</span> <span style="color:#111">arraySize1</span> <span style="color:#f92672">=</span> <span style="color:#111">sz</span><span style="color:#111">;</span>  <span style="color:#75715e">// error: value not known at compilation
</span><span style="color:#75715e"></span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">array</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span> <span style="color:#111">sz</span><span style="color:#f92672">&gt;</span> <span style="color:#111">data1</span><span style="color:#111">;</span>       <span style="color:#75715e">// error: same problem
</span><span style="color:#75715e"></span><span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">auto</span> <span style="color:#111">arraySize2</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#111">;</span>  <span style="color:#75715e">// fine: 10 is compile-time constant
</span><span style="color:#75715e"></span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">array</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span> <span style="color:#111">arraySize2</span><span style="color:#f92672">&gt;</span> <span style="color:#111">data2</span><span style="color:#111">;</span> <span style="color:#75715e">// fine, arraySize2 is constexpr
</span></code></pre></td></tr></table>
</div>
</div><p>All <code>constexpr</code> objects are <code>const</code>, but not all <code>const</code> objects are <code>constexpr</code>, because <code>const</code> objects need not be initialized with values known during compilations:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">int</span> <span style="color:#111">sz</span><span style="color:#111">;</span>
<span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#00a8c8">const</span> <span style="color:#00a8c8">auto</span> <span style="color:#111">arraySize</span> <span style="color:#f92672">=</span> <span style="color:#111">sz</span><span style="color:#111">;</span>  <span style="color:#75715e">// fine: arraySize is const copy of sz
</span><span style="color:#75715e"></span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">array</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span> <span style="color:#111">arraySize</span><span style="color:#f92672">&gt;</span>  <span style="color:#111">data</span><span style="color:#111">;</span> <span style="color:#75715e">// error: arraySize&#39;s value not known at compilation
</span></code></pre></td></tr></table>
</div>
</div><h1 id="constexpr-functions"><code>constexpr</code> functions</h1>
<p><code>constexpr</code> is part of a functions's interface, which proclaims &ldquo;I can be used in a context where C++ requires a constant expression.&rdquo; In other words:</p>
<ul>
<li>if the values of the arguments we pass to a <code>constexpr</code> function are known during compilation, the result will be computed during compilation</li>
<li>when a <code>constexpr</code> function is called with one or more values that are not known during compilation, it acts like a normal function, computing its result at runtime: so that we don't need two functions to perform the same operation.</li>
</ul>
<p>For example, we want to initialize a <code>std::array</code> with the size of 3^n, wher n is a known integer (or can be computed) during compilation. <code>std::pow</code> doesn't help here, because</p>
<ol>
<li><code>std::pow</code> works on floating-point types, while we need an integral result</li>
<li><code>std::pow</code> isn't constexpr</li>
</ol>
<p>Thus, we write the pow we need:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">constexpr</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">pow</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">base</span><span style="color:#111">,</span> <span style="color:#00a8c8">unsigned</span> <span style="color:#111">exp</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span>  <span style="color:#75715e">// never throws
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>  <span style="color:#75715e">// impl is below
</span><span style="color:#75715e"></span><span style="color:#111">}</span>

<span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">auto</span> <span style="color:#111">numConds</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#111">;</span>   <span style="color:#75715e">// # of conditions
</span><span style="color:#75715e"></span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">array</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">int</span><span style="color:#111">,</span> <span style="color:#111">pow</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#111">numConds</span><span style="color:#111">)</span><span style="color:#f92672">&gt;</span> <span style="color:#111">results</span><span style="color:#111">;</span> <span style="color:#75715e">// results has 3^numConds elements
</span><span style="color:#75715e"></span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#00a8c8">auto</span> <span style="color:#111">base</span> <span style="color:#f92672">=</span> <span style="color:#111">readFromDB</span><span style="color:#111">(</span><span style="color:#d88200"></span><span style="color:#d88200">&#34;</span><span style="color:#d88200">base</span><span style="color:#d88200">&#34;</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// get the value at runtime
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">exp</span> <span style="color:#f92672">=</span> <span style="color:#111">readFromDB</span><span style="color:#111">(</span><span style="color:#d88200"></span><span style="color:#d88200">&#34;</span><span style="color:#d88200">exponent</span><span style="color:#d88200">&#34;</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// ditto
</span><span style="color:#75715e"></span><span style="color:#00a8c8">auto</span> <span style="color:#111">baseToExp</span> <span style="color:#f92672">=</span> <span style="color:#111">pow</span><span style="color:#111">(</span><span style="color:#111">base</span><span style="color:#111">,</span> <span style="color:#111">exp</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// we can also call pow function at runtime, of course
</span></code></pre></td></tr></table>
</div>
</div><p>In C++11, there're some restrictions on <code>constexpr</code> functions:</p>
<ol>
<li>they may only contain a single return statement</li>
<li>they are limited to taking and returning <em>literal types</em><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></li>
</ol>
<p>so the implementation goes like this:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">int</span> <span style="color:#75af00">pow</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">base</span><span style="color:#111">,</span> <span style="color:#00a8c8">unsigned</span> <span style="color:#111">exp</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">(</span><span style="color:#111">exp</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#111">base</span> <span style="color:#f92672">*</span> <span style="color:#111">pow</span><span style="color:#111">(</span><span style="color:#111">base</span><span style="color:#111">,</span> <span style="color:#111">exp</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>For C++14, the restrictions are substantially looser:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">int</span> <span style="color:#75af00">pow</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">base</span><span style="color:#111">,</span> <span style="color:#00a8c8">unsigned</span> <span style="color:#111">exp</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">auto</span> <span style="color:#111">result</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">unsigned</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">exp</span><span style="color:#111">;</span> <span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#111">i</span><span style="color:#111">)</span> <span style="color:#111">result</span> <span style="color:#f92672">*</span><span style="color:#f92672">=</span> <span style="color:#111">base</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">result</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>constexpr</code> functions can work with user-defined literal types, too:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">class</span> <span style="color:#75af00">Point</span> <span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">constexpr</span> <span style="color:#111">Point</span><span style="color:#111">(</span><span style="color:#00a8c8">double</span> <span style="color:#111">xVal</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">dobule</span> <span style="color:#111">yVal</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span>
    <span style="color:#f92672">:</span> <span style="color:#111">x</span><span style="color:#111">(</span><span style="color:#111">xVal</span><span style="color:#111">)</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">(</span><span style="color:#111">yVal</span><span style="color:#111">)</span>
    <span style="color:#111">{</span><span style="color:#111">}</span>

    <span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">double</span> <span style="color:#75af00">xValue</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span> <span style="color:#00a8c8">noexcept</span> <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#111">x</span><span style="color:#111">;</span> <span style="color:#111">}</span>
    <span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">double</span> <span style="color:#75af00">yValue</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span> <span style="color:#00a8c8">noexcept</span> <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#111">y</span><span style="color:#111">;</span> <span style="color:#111">}</span>
    <span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setX</span><span style="color:#111">(</span><span style="color:#00a8c8">double</span> <span style="color:#111">newX</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span> <span style="color:#111">{</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">newX</span><span style="color:#111">;</span> <span style="color:#111">}</span>  <span style="color:#75715e">// due to &#34;void&#34; return type, 
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setY</span><span style="color:#111">(</span><span style="color:#00a8c8">double</span> <span style="color:#111">newY</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span> <span style="color:#111">{</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">newY</span><span style="color:#111">;</span>    <span style="color:#75715e">// setters&#39;re contexpr only in C++14
</span><span style="color:#75715e"></span><span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">double</span> <span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">;</span>
<span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#00a8c8">constexpr</span>
<span style="color:#111">Point</span> <span style="color:#75af00">midpoint</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">Point</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p1</span><span style="color:#111">,</span> <span style="color:#00a8c8">const</span> <span style="color:#111">Point</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p2</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">{</span> <span style="color:#111">(</span><span style="color:#111">p1</span><span style="color:#111">.</span><span style="color:#111">xValue</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span><span style="color:#111">.</span><span style="color:#111">xValue</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span>
             <span style="color:#111">(</span><span style="color:#111">p1</span><span style="color:#111">.</span><span style="color:#111">yValue</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span><span style="color:#111">.</span><span style="color:#111">yValue</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#111">}</span><span style="color:#111">;</span>  <span style="color:#75715e">// call constexpr member funcs
</span><span style="color:#75715e"></span><span style="color:#111">}</span>

<span style="color:#00a8c8">constexpr</span> <span style="color:#111">Point</span> <span style="color:#75af00">reflection</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">Point</span><span style="color:#f92672">&amp;</span> <span style="color:#111">p</span><span style="color:#111">)</span> <span style="color:#00a8c8">noexcept</span>
<span style="color:#111">{</span>
    <span style="color:#111">Point</span> <span style="color:#111">result</span><span style="color:#111">;</span>           <span style="color:#75715e">// create non-const Point
</span><span style="color:#75715e"></span>    <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#111">setX</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">p</span><span style="color:#111">.</span><span style="color:#111">xValue</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// set its x and y value
</span><span style="color:#75715e"></span>    <span style="color:#111">result</span><span style="color:#111">.</span><span style="color:#111">setY</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">p</span><span style="color:#111">.</span><span style="color:#111">yValue</span><span style="color:#111">)</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">result</span><span style="color:#111">;</span>          <span style="color:#75715e">// return copy of it
</span><span style="color:#75715e"></span><span style="color:#111">}</span>

</code></pre></td></tr></table>
</div>
</div><p>By introducing <code>constexpr</code>, we can maximize the range of situation our objects and functions may be used - the traditionally fairly strict line between work done during compilation and work done at runtime begins to blur after we use <code>constexpr</code> constructors, <code>constexpr</code> getters, <code>constexpr</code> setters, <code>constepxr</code> non-member functions, and create objects in read-only memory:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">constexpr</span> <span style="color:#111">Point</span> <span style="color:#75af00">p1</span><span style="color:#111">(</span><span style="color:#ae81ff">9.4</span><span style="color:#111">,</span> <span style="color:#ae81ff">27.7</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// &#34;runs&#34; constexpr ctor during compilation
</span><span style="color:#75715e"></span><span style="color:#00a8c8">constexpr</span> <span style="color:#111">Point</span> <span style="color:#75af00">p2</span><span style="color:#111">(</span><span style="color:#ae81ff">28.8</span><span style="color:#111">,</span> <span style="color:#ae81ff">5.3</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// same
</span><span style="color:#75715e"></span><span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">auto</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">midpoint</span><span style="color:#111">(</span><span style="color:#111">p1</span><span style="color:#111">,</span> <span style="color:#111">p2</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// init constexpr object with result of constexpr func
</span><span style="color:#75715e"></span><span style="color:#00a8c8">constexpr</span> <span style="color:#00a8c8">auto</span> <span style="color:#111">reflectedMid</span> <span style="color:#f92672">=</span> <span style="color:#111">reflection</span><span style="color:#111">(</span><span style="color:#111">mid</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// reflectedMid&#39;s value is known during compilation
</span></code></pre></td></tr></table>
</div>
</div><p>As a result, the more code taking part in the compilation time, the faster our software will run<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Such contexts include specification of array sizes, integral template arguments, enumerator values, alignment specifiers, etc. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Literal types: types that can have values determined during compilation. In C++11, all built-in types except <code>void</code> qualify, plus some user-defined types whose constructors and other member functions are <code>constexpr</code>. <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>Compilation may take longer, however. <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
