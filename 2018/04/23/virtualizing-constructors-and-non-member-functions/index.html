<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>[MECpp]Item-25 Virtualizing Constructors and Non-Member Functions - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>[MECpp]Item-25 Virtualizing Constructors and Non-Member Functions</h1>
  </div>
<div class="meta">
  <div>2018-04-23 13:30</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      <span><a href="https://sy123.ml/tags/cpp/">#cpp</a></span>
      </div>
  </div>
<div class="content">
  <p>Depending on the different input or dynamic types of function parameters, &ldquo;virtualization&rdquo; is a useful technique to construct new objects of different types accordingly, or to conceive of non-member functions whose behavior changes accordingly.</p>
<!-- toc -->
<p>Constructors and non-member functions can't really be virtual. We just make them act &ldquo;virtually&rdquo; so that it is easier to use. The term &ldquo;virtual&rdquo; means that a function will achieve type-specific behavior when we have a pointer or reference to an object without knowing its dynamic type in advance.</p>
<h1 id="virtual-constructor">Virtual constructor</h1>
<p>Suppose we write applications for working with newsletters, where a newsletter consists of components that are either textual or graphical:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">class</span> <span style="color:#75af00">NLComponent</span> <span style="color:#111">{</span>  <span style="color:#75715e">// abstract base class for newsletter components
</span><span style="color:#75715e"></span><span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#75715e">// constain at least one pure virtual function
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">virtual</span> <span style="color:#111">NLComponet</span> <span style="color:#f92672">*</span> <span style="color:#111">clone</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75715e">// virtual copy constructor
</span><span style="color:#75715e"></span>    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#00a8c8">class</span> <span style="color:#75af00">TextBlocks</span><span style="color:#f92672">:</span> <span style="color:#00a8c8">public</span> <span style="color:#111">NLComponent</span> <span style="color:#111">{</span> <span style="color:#75715e">// 
</span><span style="color:#75715e"></span><span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#111">TextBlock</span> <span style="color:#f92672">*</span> <span style="color:#111">clone</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span>  <span style="color:#75715e">// virtual copy constructor
</span><span style="color:#75715e"></span>    <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">new</span> <span style="color:#75af00">TextBlock</span><span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#00a8c8">this</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#111">}</span>  
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>                                <span style="color:#75715e">// constain no pure virtual function
</span><span style="color:#75715e"></span><span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#00a8c8">class</span> <span style="color:#75af00">Graphic</span><span style="color:#f92672">:</span> <span style="color:#00a8c8">public</span> <span style="color:#111">NLComponent</span> <span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#111">Graphic</span> <span style="color:#f92672">*</span> <span style="color:#111">clone</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span>  <span style="color:#75715e">// virtual copy constructor
</span><span style="color:#75715e"></span>    <span style="color:#111">{</span> <span style="color:#00a8c8">return</span> <span style="color:#00a8c8">new</span> <span style="color:#75af00">Graphic</span><span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#00a8c8">this</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#111">}</span> 
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>                                <span style="color:#75715e">// constain no pure virtual function    
</span><span style="color:#75715e"></span><span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#00a8c8">class</span> <span style="color:#75af00">NewsLetter</span> <span style="color:#111">{</span>  <span style="color:#75715e">// a newsletter object consists of a list of NLComponent objects
</span><span style="color:#75715e"></span><span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#111">NewsLetter</span><span style="color:#111">(</span><span style="color:#111">istream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">str</span><span style="color:#111">)</span><span style="color:#111">;</span>
    <span style="color:#111">NewsLetter</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">NewsLetter</span><span style="color:#f92672">&amp;</span> <span style="color:#111">rhs</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// normal copy constructor
</span><span style="color:#75715e"></span>    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
    <span style="color:#111">list</span><span style="color:#f92672">&lt;</span><span style="color:#111">NLComponet</span><span style="color:#f92672">*</span><span style="color:#f92672">&gt;</span> <span style="color:#111">components</span><span style="color:#111">;</span> 
    <span style="color:#00a8c8">static</span> <span style="color:#111">NLComponet</span> <span style="color:#f92672">*</span> <span style="color:#75af00">readComponet</span><span style="color:#111">(</span><span style="color:#111">istream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">str</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// read the data for the next NLComponet from str, create the component and return a pointer to it
</span><span style="color:#75715e"></span><span style="color:#111">}</span><span style="color:#111">;</span>
</code></pre></td></tr></table>
</div>
</div><p>The classes relate in this way:</p>
<pre><code>NewsLetter object
┌───────────────┐
│     ...       │
├───────────────┤                    ┌──────────────┐
│[list object]--│-----pointers------&gt;│  NLComponent │
└───────────────┘                    └──────────────┘
                       public inheritance ↗   ↖ public inheritance
                             ┌───────────┐      ┌──────────┐
                             │ TextBlock │      │  Graphic │
                             └───────────┘      └──────────┘
</code></pre><p>Suppose <code>NewsLetter</code> objects are stored on disk, it is convevient that <code>NewsLetter</code>  takes an <code>istream</code> to read information from the stream as it creates the necessary in-core data structures. Depending on the data it reads, we need to create either a <code>TextBlock</code> or a <code>Graphic</code>, which are different types of objects. Here comes the <code>readComponent</code>, which acts like constructor for its creating new objects, while it is also able to create different types of objects according to the iput it is given. Thus we call such a constructor as the <em>virtual constructor</em>, which are useful in many constexts.</p>
<p>Given <code>readComponent</code> acting as a virtual constructor, it is easy to implement the constructor for <code>NewsLetter</code>:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">NewsLetter</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">NewsLetter</span><span style="color:#111">(</span><span style="color:#111">istream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">str</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">str</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#111">componets</span><span style="color:#111">.</span><span style="color:#111">push_back</span><span style="color:#111">(</span><span style="color:#111">readComponet</span><span style="color:#111">(</span><span style="color:#111">str</span><span style="color:#111">)</span><span style="color:#111">)</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Among all kinds of virtual functions, there is another widely useful one: the <em>virtual copy constructor</em>, which returns a pointer to a new copy of the object invoking the function, and is typically named like <code>copySelf</code>, <code>cloneSelf</code>, or simply <code>clone</code>. These virtual copy constructors just calls its real copy constructor, so that the meaning of &ldquo;copy&rdquo; keeps the same for both functions<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> - consistency.</p>
<p>Notice that a derived class's redefinition of a base class's virtual function declare different return types here: if the function's return type is a pointer (or a reference) to a base class, the derived class's function may return a pointer (or reference)  to a class derived from that base class. Thus <code>TextBlock</code>'s <code>clone</code> returns a <code>TextBlock*</code> and <code>Graphic</code>'s <code>clone</code> returns a <code>Graphic*</code> while the return type of <code>NLComponent</code>'s <code>clone</code> is <code>NLComponent*</code>.</p>
<p>Taking advantage of the virtual copy constructor in <code>NLComponent</code>, <code>NewsLetter</code> only need to implement a normal copy constructor:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">NewsLetter</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">NewsLetter</span><span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#111">NewsLetter</span><span style="color:#f92672">&amp;</span> <span style="color:#111">rhs</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// normal copy constructor impl. in terms of virtual copy constructor
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
    <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#111">list</span><span style="color:#f92672">&lt;</span><span style="color:#111">NLComponent</span><span style="color:#f92672">*</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">const_iterator</span> <span style="color:#111">it</span> <span style="color:#f92672">=</span> <span style="color:#111">rhs</span><span style="color:#111">.</span><span style="color:#111">components</span><span style="color:#111">.</span><span style="color:#111">begin</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">;</span>
         <span style="color:#111">it</span> <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#111">rhs</span><span style="color:#111">.</span><span style="color:#111">componets</span><span style="color:#111">.</span><span style="color:#111">end</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">;</span>
         <span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#111">it</span><span style="color:#111">)</span> <span style="color:#111">{</span>
             <span style="color:#111">componets</span><span style="color:#111">.</span><span style="color:#111">push_back</span><span style="color:#111">(</span><span style="color:#111">(</span><span style="color:#f92672">*</span><span style="color:#111">it</span><span style="color:#111">)</span><span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span><span style="color:#111">clone</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">)</span><span style="color:#111">;</span>
         <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="virtual-non-member-functions">Virtual Non-member functions</h1>
<p>Suppose we'd like to implement output operators for the <code>TextBlock</code> and <code>Graphic</code> classes. Given that the defaultly output operator <code>operator&lt;&lt;</code> takes an <code>ostream&amp;</code> as its left-hand argument, we can not make it a member function of the <code>TextBlock</code> or <code>Graphic</code> classes, so it can't be declared as <code>virtual</code>. On the other hand, if we insist on declaring a virtual function for printing (e.g., <code>print</code>), and thus define a <code>print</code> for the <code>TextBlock</code> and <code>Graphic</code>, the syntax for printing <code>TextBlock</code> and <code>Graphic</code> objects is inconsistent with that for the other types in the language, which makes our clients unhappy.</p>
<p>What we want it a non-member function called <code>operator&lt;&lt;</code> that exhibits the behavior of a virtual function like <code>print</code>. The solution? We define both <code>operator&lt;&lt;</code> and <code>print</code> and have the former call the latter, and we get the virtual-acting non-member function:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">class</span> <span style="color:#75af00">NLComponent</span> <span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">s</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#00a8c8">class</span> <span style="color:#75af00">TextBlock</span><span style="color:#f92672">:</span> <span style="color:#00a8c8">public</span> <span style="color:#111">NLComponent</span> <span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">s</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span><span style="color:#111">;</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">class</span> <span style="color:#75af00">Graphic</span><span style="color:#f92672">:</span> <span style="color:#00a8c8">public</span> <span style="color:#111">NLComponent</span> <span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">s</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span><span style="color:#111">;</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>

<span style="color:#111">iinline</span> <span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#00a8c8">operator</span><span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span><span style="color:#111">(</span><span style="color:#111">ostream</span><span style="color:#f92672">&amp;</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">const</span> <span style="color:#111">NLComponent</span><span style="color:#f92672">&amp;</span> <span style="color:#111">c</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">c</span><span style="color:#111">.</span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">s</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Since the non-virtual function does nothing but call the virtual function that does the real work, we inline the non-virtual function to avoid the cost of a function call.</p>
<p>Note that, although not easy, it is possible to make non-member functions act virtually on more than one of their arguments - details in MECpp item 31.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>If the real copy constructor performs a deep copy, so does the virtual copy constructor. If the real copy constructor does something fancy like reference counting or copy-on-write (MECpp item 29), so does the virtual copy constructor. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
