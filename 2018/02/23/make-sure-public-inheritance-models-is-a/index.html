<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>Item-32 Make sure public inheritance models &#34;Is-A&#34; - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>Item-32 Make sure public inheritance models &#34;Is-A&#34;</h1>
  </div>
<div class="meta">
  <div>2018-02-23 12:59</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      <span><a href="https://sy123.ml/tags/cpp/">#cpp</a></span>
      </div>
  </div>
<div class="content">
  <p>Everything that applies to base classes must also apply to derived classes in public inheritance, for every derived class object <em>is</em> a base class object.</p>
<p>There are multiple relationships that can exist between classes:</p>
<ul>
<li>&ldquo;is-a&rdquo; is talked about in this item.</li>
<li>&ldquo;has-a&rdquo; is discussed about in item 38.</li>
<li>&ldquo;is-implemented-in-terms-of&rdquo; is introduced in item 39.</li>
</ul>
<p>We should understand the differencea among these relationships.</p>
<p>For &ldquo;is-a&rdquo;, we should understand it in this way: if the class D (&ldquo;derived&rdquo;) <strong>publicly</strong> inherits from class B (&ldquo;base), C++ compilers will assume that every object of type D is also an object of type B, but not <em>vice versa</em>. That is, every D is-a B, but not vice versa <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>The concept of is-a sounds simple, but sometimes our intuition may mislead us. Say we want to create class <code>Square</code> and class <code>Rectangle</code>. I hear you say:</p>
<blockquote>
<p>Everybody knows that a square is a rectangle, but generally not vice versa</p>
</blockquote>
<p>Then consider this code:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">class</span> <span style="color:#75af00">Rectangle</span> <span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#00a8c8">void</span> <span style="color:#111">setHeight</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">newHeight</span><span style="color:#111">)</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">virtual</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">setWidth</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">newWidth</span><span style="color:#111">)</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">virtual</span> <span style="color:#00a8c8">int</span> <span style="color:#75af00">height</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span><span style="color:#111">;</span>  <span style="color:#75715e">// return current values
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">virtual</span> <span style="color:#00a8c8">int</span> <span style="color:#75af00">width</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#00a8c8">const</span><span style="color:#111">;</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#00a8c8">void</span> <span style="color:#75af00">makeBigger</span><span style="color:#111">(</span><span style="color:#111">Rectangle</span><span style="color:#f92672">&amp;</span> <span style="color:#111">r</span><span style="color:#111">)</span>  <span style="color:#75715e">// function to increase r&#39;s area
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">oldHeight</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">.</span><span style="color:#111">height</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">;</span>
    <span style="color:#111">r</span><span style="color:#111">.</span><span style="color:#111">setWidth</span><span style="color:#111">(</span><span style="color:#111">r</span><span style="color:#111">.</span><span style="color:#111">width</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// add 10 to r&#39;s width
</span><span style="color:#75715e"></span>    <span style="color:#111">assert</span><span style="color:#111">(</span><span style="color:#111">r</span><span style="color:#111">.</span><span style="color:#111">height</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#111">oldHeight</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// assert that r&#39;s height is unchanged
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">class</span> <span style="color:#75af00">Square</span><span style="color:#f92672">:</span> <span style="color:#00a8c8">public</span> <span style="color:#111">Rectangle</span> <span style="color:#111">{</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">}</span><span style="color:#111">;</span>

<span style="color:#111">Square</span> <span style="color:#111">s</span><span style="color:#111">;</span>
<span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">assert</span><span style="color:#111">(</span><span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#111">width</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#111">height</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// must be true for all squares
</span><span style="color:#75715e"></span><span style="color:#111">makeBigger</span><span style="color:#111">(</span><span style="color:#111">s</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// by inheritance, s is-a Rectangle, so we can increase its area
</span><span style="color:#75715e"></span><span style="color:#111">assert</span><span style="color:#111">(</span><span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#111">width</span><span style="color:#111">(</span><span style="color:#111">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">.</span><span style="color:#111">height</span><span style="color:#111">(</span><span style="color:#111">)</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// must be true for all squares
</span></code></pre></td></tr></table>
</div>
</div><p>Now we face a big problem: how can we reconcile the following assertion:</p>
<ul>
<li>before calling <code>makeBigger</code>, <code>s</code>'s height is the same as its width;</li>
<li>inside <code>makeBigger</code>, <code>s</code>'s width is changed, but its height is not;</li>
<li>after returning from <code>makeBigger</code>, <code>s</code>'s height is again the same as its width</li>
</ul>
<p>Here, the instincts we've develped in mathematics does not serve well. In this case, something applies to a rectangle is not applicable to a square, but public inheritance asserts that <strong>everthing</strong> that applies to base class object also applies to derived class objects. Thus using public inheritance to model the relationship between <code>Rectangle</code> and <code>Square</code> is incorrect.</p>
<p>With the knowledge of inheritance added into our arsenal of design, we'll have to augment our intuition with new insights to guide us in inheritance's proper application.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>This is true only for <em>public</em> inheritance. Private inheritance means somethign entirely different (item 39), and protected inheritance is something beyond understanding. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
