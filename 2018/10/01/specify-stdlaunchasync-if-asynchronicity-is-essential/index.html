<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>[EMCpp]Item-36 Specify std::launch::async if Asynchronicity Is Essential - sy123.ml</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://sy123.ml/">sy123.ml</a></h1><h2><a href="https://sy123.ml/">winter is coming.</a></h2>
  </div>
  <nav><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>[EMCpp]Item-36 Specify std::launch::async if Asynchronicity Is Essential</h1>
  </div>
<div class="meta">
  <div>2018-10-01 18:33</div>
  <div>
    <span><a href="https://sy123.ml/tags/technique/">#technique</a></span>
      <span><a href="https://sy123.ml/tags/cpp/">#cpp</a></span>
      </div>
  </div>
<div class="content">
  <p>The flexibility that default policy for <code>std::async</code> permits both async and sync task execution leads to uncertainty when accessing <code>thread_locals</code>, implies that the task may never execute, and affects program logic for timeout-based <code>wait</code> calls.</p>
<p>When requesting a function <code>f</code> to be run in accord with a <code>std::async</code>, there are two standard <em>launch policies</em>, each represented by an enumerator in the <code>std::launch</code> scoped enum:</p>
<ul>
<li><strong>The <code>std::launch::async</code> launch policy</strong>: <code>f</code> must be run asynchronously on a different thread.</li>
<li><strong>The <code>std::launch::deferred</code> launch policy</strong>: <code>f</code> may run only when <code>get</code> or <code>wait</code> is called on the future returned by <code>std::async</code>.</li>
</ul>
<p>In the 2nd policy, things go like this: <code>f</code>'s execution is <em>deferred</em> until a caller invokes <code>get</code> or <code>wait</code>,  upon which time <code>f</code> will execute synchronously and block the caller until <code>f</code> finishes running. If neither <code>get</code> nor <code>wait</code> is called, <code>f</code> will never run.</p>
<p>The default launch policy, however, uses an OR-ed version of the above two policies:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">auto</span> <span style="color:#111">fut1</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">(</span><span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// the same meaning as below
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">auto</span> <span style="color:#111">fut2</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">(</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">launch</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span> <span style="color:#f92672">|</span> 
                       <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">launch</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">deferred</span><span style="color:#111">,</span>
                       <span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">;</span>
</code></pre></td></tr></table>
</div>
</div><p>This default policy permits <code>f</code> to be run either asynchronously or synchronously, depending on the decision of thread-management components of the Standard Library about the best step to do to avoid oversubscription and load balancing. This flexibility, however, also imtroduces some limitations:</p>
<ul>
<li>
<p>It's not possible to predict whether <code>f</code> will run concurrently with <code>t</code>, since <code>f</code> might be scheduled to run deferred.</p>
</li>
<li>
<p>It's not possible to predict whether <code>f</code> runs on a thread different from the thread invoking <code>get</code> or <code>wait</code> on <code>fut</code></p>
</li>
<li>
<p>It may not be possible to predict whether <code>f</code> runs at all, since it may not be possible to guarantee that <code>get</code> or <code>wait</code> will be called on <code>fut</code> along every path through the program</p>
</li>
<li>
<p>It affects <code>wait</code>-based loops using timeouts, since calling <code>wait_for</code> or <code>wait_until</code> on a task that's deferred yields the value <code>std::future_status_deferred</code>, leading to following code run forever in some special cases:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">literals</span><span style="color:#111">;</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">f</span><span style="color:#111">(</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">this_thread</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">sleep_for</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">s</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
  
<span style="color:#00a8c8">auto</span> <span style="color:#111">fut</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">(</span><span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// run f in default launch policy
</span><span style="color:#75715e"></span>  
<span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">fut</span><span style="color:#111">.</span><span style="color:#111">wait_for</span><span style="color:#111">(</span><span style="color:#ae81ff">100</span><span style="color:#111">ms</span><span style="color:#111">)</span> <span style="color:#f92672">!</span><span style="color:#f92672">=</span>      <span style="color:#75715e">// f never yield read 
</span><span style="color:#75715e"></span>       <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">future_status</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">ready</span><span style="color:#111">)</span>  <span style="color:#75715e">// when deferred
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="solution">Solution</h4>
<p>To deal with these limitations, if we use both the default launch policy as well as the timeout-based <code>wait</code> calls, we need to check for deferred case:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>
<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">fut</span><span style="color:#111">.</span><span style="color:#111">wait_for</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">s</span><span style="color:#111">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> 
    <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">future_status</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">deferred</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span> <span style="color:#75715e">// use wait or get on fut to call f synchronously
</span><span style="color:#75715e"></span><span style="color:#111">}</span> <span style="color:#00a8c8">else</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">fut</span><span style="color:#111">.</span><span style="color:#111">wait_for</span><span style="color:#111">(</span><span style="color:#ae81ff">100</span><span style="color:#111">ms</span><span style="color:#111">)</span> <span style="color:#f92672">!</span><span style="color:#f92672">=</span>      <span style="color:#75715e">// f never yield read 
</span><span style="color:#75715e"></span>           <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">future_status</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">ready</span><span style="color:#111">)</span>  <span style="color:#75715e">// when deferred
</span><span style="color:#75715e"></span>    <span style="color:#111">{</span> 
        <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span> <span style="color:#75715e">// do concurrent work until it&#39;s ready
</span><span style="color:#75715e"></span>    <span style="color:#111">}</span>
    <span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span>  <span style="color:#75715e">// fut is ready
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In summary, using <code>std::async</code> with the default launch policy for a task is fine as long as following conditions are fulfilled:</p>
<ul>
<li>The task need not run concurrently with the thread calling <code>get</code> or <code>wait</code></li>
<li>It doesn't matter which thread's thread_local variables are read or written</li>
<li>Either there's a guarantee that <code>get</code> or <code>wait</code> will be called on the future returned by <code>std::async</code> or it's acceptable that the task may never execute</li>
<li>Code using <code>wait_for</code> or <code>wait_until</code> takes the possibility of deferred status into account like above example.</li>
</ul>
<p>If any of the conditions above fails to hold, schedule the task for truly asynchronous execution:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">auto</span> <span style="color:#111">fut</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">(</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">launch</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">,</span> <span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">;</span>  <span style="color:#75715e">// launch f asynchronously
</span></code></pre></td></tr></table>
</div>
</div><p>A nice wrapper for this purpose goes like this:</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// C++11 version
</span><span style="color:#75715e"></span><span style="color:#00a8c8">template</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">typename</span> <span style="color:#111">F</span><span style="color:#111">,</span> <span style="color:#00a8c8">typename</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span> <span style="color:#111">Ts</span><span style="color:#f92672">&gt;</span>
<span style="color:#00a8c8">inline</span>
<span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">future</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">typename</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">result_of</span><span style="color:#f92672">&lt;</span><span style="color:#111">F</span><span style="color:#111">(</span><span style="color:#111">Ts</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">)</span><span style="color:#f92672">&gt;</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">type</span><span style="color:#f92672">&gt;</span>
<span style="color:#111">reallyAsync</span><span style="color:#111">(</span><span style="color:#111">F</span><span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">f</span><span style="color:#111">,</span> <span style="color:#111">Ts</span><span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span> <span style="color:#111">params</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">(</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">launch</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">,</span> 
                      <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">forward</span><span style="color:#f92672">&lt;</span><span style="color:#111">F</span><span style="color:#f92672">&gt;</span><span style="color:#111">(</span><span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">,</span> 
                      <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">forward</span><span style="color:#f92672">&lt;</span><span style="color:#111">Ts</span><span style="color:#f92672">&gt;</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">auto</span> <span style="color:#111">fut</span> <span style="color:#f92672">=</span> <span style="color:#111">reallyAsync</span><span style="color:#111">(</span><span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">;</span> <span style="color:#75715e">// run f asynchronously; throw if std::async would throw
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// C++14 version
</span><span style="color:#75715e"></span><span style="color:#00a8c8">template</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">typename</span> <span style="color:#111">F</span><span style="color:#111">,</span> <span style="color:#00a8c8">typename</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span> <span style="color:#111">Ts</span><span style="color:#f92672">&gt;</span>
<span style="color:#00a8c8">inline</span>
<span style="color:#00a8c8">auto</span>
<span style="color:#111">reallyAsync</span><span style="color:#111">(</span><span style="color:#111">F</span><span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#111">f</span><span style="color:#111">,</span> <span style="color:#111">Ts</span><span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span> <span style="color:#111">params</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">(</span><span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">launch</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">async</span><span style="color:#111">,</span>
                      <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">forward</span><span style="color:#f92672">&lt;</span><span style="color:#111">F</span><span style="color:#f92672">&gt;</span><span style="color:#111">(</span><span style="color:#111">f</span><span style="color:#111">)</span><span style="color:#111">,</span>
                      <span style="color:#111">std</span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#111">forward</span><span style="color:#f92672">&lt;</span><span style="color:#111">Ts</span><span style="color:#f92672">&gt;</span><span style="color:#111">(</span><span style="color:#111">params</span><span style="color:#111">)</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">.</span><span style="color:#111">)</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div></div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2020 Zhili.</div>
  </div>
</footer>
</body>
</html>
