<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="zhili">
<meta name="description" content="Sed magna purus, fermentum eu, tincidunt eu, varius ut, felis. Morbi mollis tellus ac sapien. Vestibulum ullamcorper mauris at ligula. In hac habitasse platea dictumst. Vivamus in erat ut urna cursus vestibulum.
    ">
<meta name="keywords" content="博客, 技术, 生物信息，精准医疗, 遗传咨询, 高通量技术, 算法, 学习, 作品, 写作, C&#43;&#43;, Perl">
<meta name="referrer" content="always">
<title>Sysprep命令详解 - zhili</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="/logo/favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <a href="https://sy123.netlify.app/">zhili</a> ❯
      <a href="/sysprep%e5%91%bd%e4%bb%a4%e8%af%a6%e8%a7%a3">Sysprep命令详解</a>/</h1>
  </div>
  <nav><a href="/file/">Files</a><a href="/tags/">Tags</a><a href="/about/">About</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>Sysprep命令详解</h1>
  </div>
<div class="meta">
  <div>🕓2020-01-20 06:12</div>
  <div>
    <span><a href="https://sy123.netlify.app/tags/windows/">#windows</a></span>
      <span><a href="https://sy123.netlify.app/tags/sysprep/">#sysprep</a></span>
      </div>
  </div>
<div class="content">
  <p>如果你打算创建安装映像以部署到不同的计算机上，则必须运行带有 <code>/generalize</code> 选项的 <code>Sysprep</code> 命令，即使其他计算机具有相同的硬件配置。<code>Sysprep /generalize</code> 命令从 Windows 安装删除唯一性信息，这使得你可以在不同的计算机上重复使用映像。下次启动 Windows 映像时，将运行 specialize 配置阶段。</p>
<p>Sysprep 命令行选项
下列命令行选项可用于 Sysprep：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps" data-lang="ps"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">Sysprep.exe</span> [<span style="color:#008080">/oobe</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#008080">/audit</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#008080">/generalize</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#008080">/mode:vm</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#008080">/reboot</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#008080">/shutdown</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#008080">/quit</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#008080">/quiet</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#008080">/unattend:</span>&lt;<span style="color:#900;font-weight:bold">answerfile</span>&gt;]
</span></span></code></pre></td></tr></table>
</div>
</div><p>下表列出了 Sysprep 命令行选项：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>/audit</td>
<td>重新启动计算机进入审核模式。审核模式使你可以将其他驱动程序或应用程序添加到 Windows。你还可以在将 Windows 安装发送给最终用户前对其进行测试。例如：</td>
</tr>
<tr>
<td>Sysprep /audit</td>
<td>如果指定了应答文件，则 Windows 安装程序的审核模式将运行 auditSystem 和 auditUser 配置阶段。</td>
</tr>
<tr>
<td>/generalize</td>
<td>准备要作为映像的 Windows 安装。Sysprep 工具会从 Windows 安装中删除所有唯一的系统信息。Sysprep 将重置安全 ID (SID)，清除所有系统还原点，并删除事件日志。例如：</td>
</tr>
<tr>
<td>Sysprep /generalize /shutdown</td>
<td>下次计算机启动时，将运行 specialize 配置阶段。该配置阶段将创建一个新安全 ID (SID)。</td>
</tr>
<tr>
<td>/oobe</td>
<td>重新启动计算机进入 OOBE 模式。例如：</td>
</tr>
<tr>
<td>Sysprep /generalize /shutdown /oobe</td>
<td>OOBE 允许最终用户自定义其 Windows 操作系统、创建用户帐户、命名计算机和执行其他任务。Sysprep 在 OOBE 启动前，将处理应答文件中 oobeSystem 配置阶段的所有设置。</td>
</tr>
<tr>
<td>/mode:vm</td>
<td>Windows(R) 8 的新增内容。一般化虚拟硬盘 (VHD)，这样可以将其部署为相同虚拟机 (VM) 或虚拟机监控程序上的 VHD。VM 重新启动后，该 VM 可以引导到 OOBE。例如：</td>
</tr>
<tr>
<td>Sysprep /generalize /oobe /mode:vm</td>
<td>仅有的适用于 VM 模式的额外交换机为“/reboot”、“/shutdown”和“/quit”。必须使用相同的硬件配置文件在虚拟机或虚拟机监控程序上部署 VHD。例如，如果你已在 Microsoft Hyper-V 中创建 VHD，仅可以使用匹配的硬件配置文件将 VHD 部署到 Microsoft Hyper-V VM。使用不同的硬件配置文件将 VHD 部署到不同的 VM 可能会导致意外的问题。</td>
</tr>
<tr>
<td>/reboot</td>
<td>重新启动计算机。可以使用该选项审核计算机并确保首次运行体验正确工作。</td>
</tr>
<tr>
<td>/shutdown</td>
<td>在 sysprep 命令完成运行后关闭计算机。</td>
</tr>
<tr>
<td>/quiet</td>
<td>运行 Sysprep 工具而不显示屏幕确认消息。如果自动运行 Sysprep 工具，则可以使用该选项。</td>
</tr>
<tr>
<td>/quit</td>
<td>Sysprep 运行指定命令后，无需重新启动或关闭计算机即可关闭 Sysprep 工具。</td>
</tr>
<tr>
<td>/unattend:<answerfile></td>
<td>在无人参与的安装过程中，将应答文件中的设置应用到 Windows，其中 <answerfile> 指定要使用的应答文件的路径和文件名。例如：Sysprep /audit /reboot /unattend:F:\Unattend.xml 其中 F 是应答文件 (Unattend.xml) 所在的便携存储设备的驱动器号。</td>
</tr>
</tbody>
</table>
<h1 id="important重要事项">Important重要事项</h1>
<p>必须使用 Sysprep /generalize 命令对完整的 Windows 安装一般化，才可以使用该安装对新计算机进行部署，无论是使用映像、硬盘复制，还是其他方法均可。不运行 Sysprep /generalize 命令而将 Windows 映像移动或复制到其他计算机的做法不受支持。</p>
<h1 id="命令行">命令行</h1>
<p><code>sysprep.exe /generalize /reboot /oobe</code></p>
<h1 id="failure-occurred-while-executing-sysprep_clean_validate_opk-from-cwindowssystem32spopkdll">Failure occurred while executing &lsquo;Sysprep_Clean_Validate_Opk&rsquo; from C:\Windows\System32\spopk.dll</h1>
<h2 id="take-ownership-of-the-file">Take ownership of the file:</h2>
<p><code>takeown /f C:\Windows\System32\spopk.dll</code></p>
<h2 id="grant-ability-to-modify-file">Grant ability to modify file:</h2>
<p><code>icacls C:\Windows\System32\spopk.dll /Grant Administrators:f</code></p>
<h1 id="预设appx删除">预设appx删除</h1>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps" data-lang="ps"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">Get-AppxProvisionedPackage</span> <span style="color:#900;font-weight:bold">-online</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">Out-GridView</span> <span style="color:#900;font-weight:bold">-PassThru</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">Remove-AppxProvisionedPackage</span> <span style="color:#900;font-weight:bold">-online</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">Get-AppxPackage</span> <span style="color:#900;font-weight:bold">-AllUsers</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">Out-GridView</span> <span style="color:#900;font-weight:bold">-PassThru</span> <span style="color:#900;font-weight:bold">|</span> <span style="color:#900;font-weight:bold">Remove-AppxPackage</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="from">From</h1>
<p><a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/sysprep--generalize--a-windows-installation">https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/sysprep&ndash;generalize&ndash;a-windows-installation</a></p>
<p><a href="http://www.edugeek.net/forums/windows-10/207219-problem-sysprep-windows-10-1903-a.html">http://www.edugeek.net/forums/windows-10/207219-problem-sysprep-windows-10-1903-a.html</a></p>
</div>
<div class="disqus">
  <div id="disqus_thread"></div>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.2/dist/disqusjs.css">
<script src="https://cdn.jsdelivr.net/gh/sy123s/blog@master/js/disqus.js"></script>
<script>
var dsqjs = new DisqusJS({
    shortname: 'sy123-ml',
    siteName: 'zhili',
    identifier: '',
    url: '',
    title: '',
    api: 'https://disqus.gd2.workers.dev/api/',
    apikey: 'gZw0N3utfdxezjRheJwLz3xkiUcRWno3ruWSIROPHRcYNGmwBosRpnyb8MmiknVg',
    admin: 'disqus_wvCW9l8bmG',
    adminLabel: 'zhili'
});
</script>
                            
</div>

  </article>
</main>
<footer>
  <div>
    <div>
      2007-2022 zhili.</div>
  </div>
</footer>
</body>
</html>
